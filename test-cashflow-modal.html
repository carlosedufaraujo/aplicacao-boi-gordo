<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Modal de Cash Flow</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .data-list {
            margin-top: 10px;
        }
        .data-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .success {
            color: #10b981;
            font-weight: bold;
        }
        .error {
            color: #ef4444;
            font-weight: bold;
        }
        .pending {
            color: #f59e0b;
            font-weight: bold;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #2563eb;
        }
        .log {
            background: #1e293b;
            color: #94a3b8;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .log-entry {
            margin: 2px 0;
        }
        .log-success {
            color: #4ade80;
        }
        .log-error {
            color: #f87171;
        }
        .log-info {
            color: #60a5fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste do Modal de Cash Flow</h1>
        <p class="subtitle">Verificando carregamento de categorias e contas</p>
        
        <div class="test-section">
            <div class="test-title">üìä Status da Conex√£o</div>
            <div id="connection-status">
                <p>Backend API: <span id="backend-status" class="pending">Verificando...</span></p>
                <p>Autentica√ß√£o: <span id="auth-status" class="pending">Verificando...</span></p>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üè∑Ô∏è Categorias</div>
            <button onclick="loadCategories()">Carregar Categorias</button>
            <div id="categories-status"></div>
            <div id="categories-list" class="data-list"></div>
        </div>

        <div class="test-section">
            <div class="test-title">üè¶ Contas</div>
            <button onclick="loadAccounts()">Carregar Contas</button>
            <div id="accounts-status"></div>
            <div id="accounts-list" class="data-list"></div>
        </div>

        <div class="test-section">
            <div class="test-title">üìù Console de Logs</div>
            <div id="log-console" class="log"></div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para adicionar logs
        function addLog(message, type = 'info') {
            const logConsole = document.getElementById('log-console');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry log-' + type;
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logConsole.appendChild(logEntry);
            logConsole.scrollTop = logConsole.scrollHeight;
        }

        // Verificar conex√£o com backend
        async function checkConnection() {
            addLog('Verificando conex√£o com backend...', 'info');
            try {
                const response = await fetch('http://localhost:3001/api/v1/health');
                if (response.ok) {
                    document.getElementById('backend-status').className = 'success';
                    document.getElementById('backend-status').textContent = 'Conectado ‚úì';
                    addLog('Backend conectado com sucesso', 'success');
                } else {
                    throw new Error('Backend n√£o respondeu');
                }
            } catch (error) {
                document.getElementById('backend-status').className = 'error';
                document.getElementById('backend-status').textContent = 'Desconectado ‚úó';
                addLog('Erro ao conectar com backend: ' + error.message, 'error');
            }

            // Verificar token de autentica√ß√£o
            const token = localStorage.getItem('token');
            if (token) {
                document.getElementById('auth-status').className = 'success';
                document.getElementById('auth-status').textContent = 'Autenticado ‚úì';
                addLog('Token de autentica√ß√£o encontrado', 'success');
            } else {
                document.getElementById('auth-status').className = 'error';
                document.getElementById('auth-status').textContent = 'N√£o autenticado ‚úó';
                addLog('Token de autentica√ß√£o n√£o encontrado', 'error');
            }
        }

        // Carregar categorias do localStorage
        async function loadCategories() {
            addLog('Carregando categorias...', 'info');
            const statusDiv = document.getElementById('categories-status');
            const listDiv = document.getElementById('categories-list');
            
            try {
                // Buscar do localStorage (como o categoryService faz)
                const stored = localStorage.getItem('financial_categories');
                
                if (stored) {
                    const categories = JSON.parse(stored);
                    addLog(`${categories.length} categorias encontradas no localStorage`, 'success');
                    
                    statusDiv.innerHTML = `<p class="success">‚úì ${categories.length} categorias carregadas</p>`;
                    
                    // Separar por tipo
                    const incomeCategories = categories.filter(cat => cat.type === 'INCOME');
                    const expenseCategories = categories.filter(cat => cat.type === 'EXPENSE');
                    
                    listDiv.innerHTML = `
                        <h4>Receitas (${incomeCategories.length}):</h4>
                        ${incomeCategories.map(cat => `
                            <div class="data-item">
                                <span>${cat.name}</span>
                                <span style="background: ${cat.color}; width: 20px; height: 20px; border-radius: 50%; display: inline-block;"></span>
                            </div>
                        `).join('')}
                        
                        <h4 style="margin-top: 20px;">Despesas (${expenseCategories.length}):</h4>
                        ${expenseCategories.map(cat => `
                            <div class="data-item">
                                <span>${cat.name}</span>
                                <span style="background: ${cat.color}; width: 20px; height: 20px; border-radius: 50%; display: inline-block;"></span>
                            </div>
                        `).join('')}
                    `;
                } else {
                    statusDiv.innerHTML = `<p class="error">‚úó Nenhuma categoria encontrada no localStorage</p>`;
                    addLog('Nenhuma categoria encontrada no localStorage', 'error');
                    
                    // Tentar inicializar categorias padr√£o
                    addLog('Inicializando categorias padr√£o...', 'info');
                    // Aqui voc√™ poderia chamar o categoryService.resetToDefaults()
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚úó Erro ao carregar categorias</p>`;
                addLog('Erro ao carregar categorias: ' + error.message, 'error');
            }
        }

        // Carregar contas da API
        async function loadAccounts() {
            addLog('Carregando contas da API...', 'info');
            const statusDiv = document.getElementById('accounts-status');
            const listDiv = document.getElementById('accounts-list');
            
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('Token de autentica√ß√£o n√£o encontrado');
                }

                const response = await fetch('http://localhost:3001/api/v1/payer-accounts', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API retornou erro: ${response.status}`);
                }
                
                const result = await response.json();
                addLog('Resposta da API recebida', 'success');
                
                if (result.status === 'success' && result.data) {
                    const accounts = result.data.items || result.data;
                    addLog(`${accounts.length} contas encontradas`, 'success');
                    
                    statusDiv.innerHTML = `<p class="success">‚úì ${accounts.length} contas carregadas</p>`;
                    
                    listDiv.innerHTML = accounts.map(account => `
                        <div class="data-item">
                            <div>
                                <strong>${account.accountName}</strong><br>
                                <small>${account.bankName} - Ag: ${account.agency || 'N/A'} - Conta: ${account.accountNumber || 'N/A'}</small>
                            </div>
                            <span>${account.isActive ? '‚úì Ativa' : '‚úó Inativa'}</span>
                        </div>
                    `).join('');
                } else {
                    statusDiv.innerHTML = `<p class="error">‚úó Nenhuma conta encontrada</p>`;
                    addLog('Nenhuma conta retornada pela API', 'error');
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚úó Erro ao carregar contas: ${error.message}</p>`;
                addLog('Erro ao carregar contas: ' + error.message, 'error');
            }
        }

        // Inicializar testes ao carregar a p√°gina
        window.onload = function() {
            addLog('P√°gina de teste carregada', 'info');
            checkConnection();
        };
    </script>
</body>
</html>