<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Interativo - Nova Compra de Gado</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 24px;
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        .content {
            padding: 24px;
        }
        .section {
            margin-bottom: 24px;
        }
        .section h2 {
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        .field {
            display: flex;
            flex-direction: column;
        }
        label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
            font-weight: 500;
        }
        input, select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .calculation-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        .calculation-card h3 {
            font-size: 14px;
            color: #374151;
            margin-bottom: 12px;
        }
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }
        .calc-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        .calc-label {
            font-size: 11px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        .calc-value {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }
        .calc-value.green { color: #10b981; }
        .calc-value.orange { color: #f59e0b; }
        .calc-value.purple { color: #8b5cf6; }
        .memory {
            background: #f3f4f6;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #6b7280;
            line-height: 1.6;
        }
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        button {
            flex: 1;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 14px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.3);
        }
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        .status {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            display: none;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
            display: block;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêÆ Teste Interativo - Nova Compra de Gado</h1>
            <p>Simule uma compra completa com c√°lculos em tempo real</p>
        </div>

        <div class="content">
            <!-- Informa√ß√µes B√°sicas -->
            <div class="section">
                <h2>üìã Informa√ß√µes B√°sicas</h2>
                <div class="grid">
                    <div class="field">
                        <label>Tipo de Animal</label>
                        <select id="animalType">
                            <option value="MALE">Macho</option>
                            <option value="FEMALE">F√™mea</option>
                            <option value="MIXED">Misto</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>Quantidade</label>
                        <input type="number" id="quantity" value="100" min="1">
                    </div>
                    <div class="field">
                        <label>Peso Total (kg)</label>
                        <input type="number" id="totalWeight" value="30000" min="1">
                    </div>
                    <div class="field">
                        <label>Rendimento (%)</label>
                        <input type="number" id="carcassYield" value="52" min="0" max="100" step="0.1">
                    </div>
                </div>
            </div>

            <!-- Valores -->
            <div class="section">
                <h2>üí∞ Valores</h2>
                <div class="grid">
                    <div class="field">
                        <label>Pre√ßo por @ (R$)</label>
                        <input type="number" id="pricePerArroba" value="300" min="0" step="0.01">
                    </div>
                    <div class="field">
                        <label>Condi√ß√£o de Pagamento</label>
                        <select id="paymentType">
                            <option value="CASH">√Ä Vista</option>
                            <option value="INSTALLMENT">A Prazo</option>
                        </select>
                    </div>
                </div>

                <!-- Card de C√°lculos -->
                <div class="calculation-card">
                    <h3>üìä Resumo de Peso e Valores</h3>
                    <div class="calc-grid">
                        <div class="calc-item">
                            <div class="calc-label">Peso Total</div>
                            <div class="calc-value" id="calcTotalWeight">30.000 kg</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">Peso por Animal</div>
                            <div class="calc-value" id="calcWeightPerAnimal">300 kg (10 @)</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">Valor da Compra</div>
                            <div class="calc-value green" id="calcPurchaseValue">R$ 300.000,00</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">Valor por Animal</div>
                            <div class="calc-value" id="calcValuePerAnimal">R$ 3.000,00</div>
                        </div>
                    </div>
                    <div class="memory" id="calcMemory"></div>
                </div>
            </div>

            <!-- Frete -->
            <div class="section">
                <h2>üöö Frete</h2>
                <div class="grid">
                    <div class="field">
                        <label>Valor R$/km</label>
                        <input type="number" id="freightCostPerKm" value="2.5" min="0" step="0.01">
                    </div>
                    <div class="field">
                        <label>Dist√¢ncia (km)</label>
                        <input type="number" id="freightDistance" value="200" min="0">
                    </div>
                </div>
                <div class="calculation-card">
                    <h3>Custo Total do Frete</h3>
                    <div class="calc-value orange" id="calcFreightCost">R$ 500,00</div>
                    <div class="memory" id="freightMemory">200 km √ó R$ 2,50/km</div>
                </div>
            </div>

            <!-- Comiss√£o -->
            <div class="section">
                <h2>üíº Comiss√£o do Corretor</h2>
                <div class="grid">
                    <div class="field">
                        <label>Tipo de Comiss√£o</label>
                        <select id="commissionType">
                            <option value="PERCENTAGE">Percentual</option>
                            <option value="FIXED">Valor Fixo</option>
                        </select>
                    </div>
                    <div class="field">
                        <label id="commissionLabel">Comiss√£o (%)</label>
                        <input type="number" id="commission" value="2" min="0" step="0.01">
                    </div>
                </div>
                <div class="calculation-card">
                    <h3>Valor da Comiss√£o</h3>
                    <div class="calc-value purple" id="calcCommission">R$ 6.000,00</div>
                    <div class="memory" id="commissionMemory">2% sobre R$ 300.000,00</div>
                </div>
            </div>

            <!-- Resumo Final -->
            <div class="calculation-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-color: #86efac;">
                <h3>üí∞ Custo Total da Compra</h3>
                <div class="calc-value green" style="font-size: 24px;" id="totalCost">R$ 306.500,00</div>
                <div class="memory" id="totalBreakdown">
                    Compra: R$ 300.000,00 + Frete: R$ 500,00 + Comiss√£o: R$ 6.000,00
                </div>
            </div>

            <!-- Bot√µes -->
            <div class="button-group">
                <button class="btn-secondary" onclick="resetForm()">Limpar</button>
                <button class="btn-primary" onclick="submitPurchase()">Enviar Compra para API</button>
            </div>

            <!-- Status -->
            <div id="status" class="status"></div>
        </div>
    </div>

    <script>
        // C√°lculos em tempo real
        function updateCalculations() {
            const quantity = parseFloat(document.getElementById('quantity').value) || 0;
            const totalWeight = parseFloat(document.getElementById('totalWeight').value) || 0;
            const carcassYield = parseFloat(document.getElementById('carcassYield').value) || 0;
            const pricePerArroba = parseFloat(document.getElementById('pricePerArroba').value) || 0;
            const freightCostPerKm = parseFloat(document.getElementById('freightCostPerKm').value) || 0;
            const freightDistance = parseFloat(document.getElementById('freightDistance').value) || 0;
            const commissionType = document.getElementById('commissionType').value;
            const commission = parseFloat(document.getElementById('commission').value) || 0;

            // C√°lculos de peso
            const weightPerAnimal = quantity > 0 ? totalWeight / quantity : 0;
            const weightPerAnimalArroba = weightPerAnimal / 30;
            
            // Valor da compra (peso total / 30 * pre√ßo por arroba)
            const purchaseValue = (totalWeight / 30) * pricePerArroba;
            const valuePerAnimal = quantity > 0 ? purchaseValue / quantity : 0;

            // Frete
            const freightCost = freightCostPerKm * freightDistance;

            // Comiss√£o
            const commissionValue = commissionType === 'PERCENTAGE' 
                ? (purchaseValue * commission / 100)
                : commission;

            // Total
            const totalCost = purchaseValue + freightCost + commissionValue;

            // Atualizar interface
            document.getElementById('calcTotalWeight').textContent = totalWeight.toLocaleString('pt-BR') + ' kg';
            document.getElementById('calcWeightPerAnimal').textContent = 
                `${weightPerAnimal.toFixed(2)} kg (${weightPerAnimalArroba.toFixed(2)} @)`;
            document.getElementById('calcPurchaseValue').textContent = 
                'R$ ' + purchaseValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            document.getElementById('calcValuePerAnimal').textContent = 
                'R$ ' + valuePerAnimal.toLocaleString('pt-BR', { minimumFractionDigits: 2 });

            // Mem√≥ria de c√°lculo com rendimento
            if (carcassYield > 0) {
                const carcassWeight = totalWeight * carcassYield / 100;
                const carcassPerAnimal = quantity > 0 ? carcassWeight / quantity : 0;
                const carcassArroba = carcassPerAnimal / 15;
                const valuePerAnimalCarcass = carcassArroba * pricePerArroba;

                document.getElementById('calcMemory').innerHTML = `
                    <strong>Mem√≥ria de C√°lculo (Rendimento ${carcassYield}%):</strong><br>
                    Peso carca√ßa: ${totalWeight.toLocaleString('pt-BR')} kg √ó ${carcassYield}% = ${carcassWeight.toLocaleString('pt-BR', { maximumFractionDigits: 2 })} kg<br>
                    Por animal: ${carcassWeight.toLocaleString('pt-BR', { maximumFractionDigits: 2 })} kg √∑ ${quantity} = ${carcassPerAnimal.toFixed(2)} kg<br>
                    Em arrobas: ${carcassPerAnimal.toFixed(2)} kg √∑ 15 = ${carcassArroba.toFixed(2)} @<br>
                    Valor/animal: ${carcassArroba.toFixed(2)} @ √ó R$ ${pricePerArroba.toFixed(2)} = R$ ${valuePerAnimalCarcass.toFixed(2)}
                `;
            }

            // Frete
            document.getElementById('calcFreightCost').textContent = 
                'R$ ' + freightCost.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            document.getElementById('freightMemory').textContent = 
                `${freightDistance} km √ó R$ ${freightCostPerKm.toFixed(2)}/km`;

            // Comiss√£o
            document.getElementById('calcCommission').textContent = 
                'R$ ' + commissionValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            document.getElementById('commissionMemory').textContent = 
                commissionType === 'PERCENTAGE' 
                    ? `${commission}% sobre R$ ${purchaseValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`
                    : 'Valor fixo';

            // Total
            document.getElementById('totalCost').textContent = 
                'R$ ' + totalCost.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            document.getElementById('totalBreakdown').textContent = 
                `Compra: R$ ${purchaseValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} + ` +
                `Frete: R$ ${freightCost.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} + ` +
                `Comiss√£o: R$ ${commissionValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        }

        // Atualizar label da comiss√£o
        document.getElementById('commissionType').addEventListener('change', function() {
            document.getElementById('commissionLabel').textContent = 
                this.value === 'PERCENTAGE' ? 'Comiss√£o (%)' : 'Comiss√£o (R$)';
            updateCalculations();
        });

        // Adicionar listeners
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('input', updateCalculations);
            element.addEventListener('change', updateCalculations);
        });

        // Reset form
        function resetForm() {
            document.getElementById('quantity').value = 100;
            document.getElementById('totalWeight').value = 30000;
            document.getElementById('carcassYield').value = 52;
            document.getElementById('pricePerArroba').value = 300;
            document.getElementById('freightCostPerKm').value = 2.5;
            document.getElementById('freightDistance').value = 200;
            document.getElementById('commission').value = 2;
            updateCalculations();
            document.getElementById('status').className = 'status';
        }

        // Submit para API
        async function submitPurchase() {
            const statusEl = document.getElementById('status');
            
            try {
                statusEl.className = 'status';
                statusEl.textContent = 'Enviando...';
                statusEl.className = 'status success';

                // Montar dados
                const data = {
                    animalType: document.getElementById('animalType').value,
                    initialQuantity: parseInt(document.getElementById('quantity').value),
                    purchaseWeight: parseFloat(document.getElementById('totalWeight').value),
                    carcassYield: parseFloat(document.getElementById('carcassYield').value),
                    pricePerArroba: parseFloat(document.getElementById('pricePerArroba').value),
                    paymentType: document.getElementById('paymentType').value,
                    freightCost: parseFloat(document.getElementById('freightCostPerKm').value) * parseFloat(document.getElementById('freightDistance').value),
                    freightDistance: parseFloat(document.getElementById('freightDistance').value),
                    commission: document.getElementById('commissionType').value === 'PERCENTAGE' 
                        ? (parseFloat(document.getElementById('totalWeight').value) / 30 * parseFloat(document.getElementById('pricePerArroba').value) * parseFloat(document.getElementById('commission').value) / 100)
                        : parseFloat(document.getElementById('commission').value),
                    commissionType: document.getElementById('commissionType').value,
                    // Adicionar outros campos necess√°rios
                    vendorId: 'cmf1f9pq2000211ymk3kwnefc', // ID de exemplo
                    payerAccountId: 'cmf0i05up00016jgvwx7pwbpj', // ID de exemplo
                    city: 'Goi√¢nia',
                    state: 'GO',
                    purchaseDate: new Date().toISOString(),
                    paymentDate: new Date().toISOString()
                };

                console.log('Dados a enviar:', data);

                // Simular resposta de sucesso
                setTimeout(() => {
                    statusEl.textContent = `‚úÖ Compra criada com sucesso! 
                        Lote: LOT-${Date.now()} 
                        Total: R$ ${((data.purchaseWeight / 30) * data.pricePerArroba + data.freightCost + data.commission).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
                }, 1000);

            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = '‚ùå Erro: ' + error.message;
            }
        }

        // Inicializar
        updateCalculations();
    </script>
</body>
</html>