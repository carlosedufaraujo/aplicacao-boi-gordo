<!DOCTYPE html>
<html>
<head>
    <title>Teste de Data Setembro</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>Teste de Seleção de Setembro no DRE</h1>
    
    <div class="test">
        <h3>1. Simulando seleção de Setembro 2025:</h3>
        <pre id="test1"></pre>
    </div>
    
    <div class="test">
        <h3>2. Teste com diferentes timezones:</h3>
        <pre id="test2"></pre>
    </div>
    
    <div class="test">
        <h3>3. Teste de API Call:</h3>
        <pre id="test3"></pre>
    </div>

    <script>
        // Teste 1: Simular seleção de setembro
        const test1 = document.getElementById('test1');
        
        // Como está no código atual (UTC)
        const dateUTC = new Date(Date.UTC(2025, 8, 1, 12, 0, 0));
        test1.innerHTML = `Data UTC criada: ${dateUTC.toISOString()}\n`;
        test1.innerHTML += `Formatada local: ${dateUTC.toLocaleString('pt-BR')}\n`;
        test1.innerHTML += `Mês (getMonth): ${dateUTC.getMonth()} (8 = setembro)\n`;
        test1.innerHTML += `Valor para API: ${dateUTC.toISOString().split('T')[0]}\n`;
        
        // Teste 2: Diferentes abordagens
        const test2 = document.getElementById('test2');
        
        // Abordagem 1: String direta
        const approach1 = '2025-09-01';
        test2.innerHTML = `Abordagem 1 (string): ${approach1}\n`;
        
        // Abordagem 2: Date local
        const approach2 = new Date(2025, 8, 1);
        test2.innerHTML += `Abordagem 2 (local): ${approach2.toISOString()}\n`;
        
        // Abordagem 3: Formato correto para backend
        const year = 2025;
        const month = 8; // Setembro (0-indexed)
        const correctDate = `${year}-${String(month + 1).padStart(2, '0')}-01`;
        test2.innerHTML += `Abordagem 3 (correta): ${correctDate}\n`;
        
        // Teste 3: Chamar API
        const test3 = document.getElementById('test3');
        
        async function testAPI() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    test3.innerHTML = 'Erro: Token não encontrado. Faça login primeiro.';
                    return;
                }
                
                // Testar com setembro
                const response = await fetch('http://localhost:3001/api/dre/by-month?month=2025-09-01', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                test3.innerHTML = `Status: ${response.status}\n`;
                test3.innerHTML += `DRE encontrado: ${data ? 'SIM' : 'NÃO'}\n`;
                if (data) {
                    test3.innerHTML += `Mês no banco: ${data.referenceMonth}\n`;
                    test3.innerHTML += `Deduções: R$ ${data.deductions || 0}\n`;
                    test3.innerHTML += `ID: ${data.id}\n`;
                }
                
            } catch (error) {
                test3.innerHTML = `Erro: ${error.message}`;
                test3.className = 'test error';
            }
        }
        
        testAPI();
    </script>
</body>
</html>