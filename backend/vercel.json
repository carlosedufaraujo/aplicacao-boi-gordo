{
  "version": 2,
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "installCommand": "npm install",
  "framework": null,
  "regions": ["gru1"],
  "env": {
    "NODE_ENV": "production",
    "PORT": "3001"
  },
  "build": {
    "env": {
      "DATABASE_URL": "@database_url",
      "JWT_SECRET": "@jwt_secret",
      "JWT_EXPIRES_IN": "@jwt_expires_in",
      "SUPABASE_URL": "@supabase_url",
      "SUPABASE_SERVICE_KEY": "@supabase_service_key",
      "REDIS_URL": "@redis_url",
      "FRONTEND_URL": "@frontend_url",
      "API_VERSION": "v1",
      "NODE_ENV": "production"
    }
  },
  "functions": {
    "dist/server.js": {
      "runtime": "nodejs20.x",
      "maxDuration": 30,
      "memory": 1024,
      "includeFiles": "dist/**"
    },
    "api/**/*.js": {
      "runtime": "nodejs20.x",
      "maxDuration": 30,
      "memory": 512
    }
  },
  "rewrites": [
    {
      "source": "/api/v1/(.*)",
      "destination": "/dist/server.js"
    },
    {
      "source": "/(.*)",
      "destination": "/dist/server.js"
    }
  ],
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Access-Control-Allow-Origin",
          "value": "*"
        },
        {
          "key": "Access-Control-Allow-Methods",
          "value": "GET, POST, PUT, DELETE, PATCH, OPTIONS"
        },
        {
          "key": "Access-Control-Allow-Headers",
          "value": "X-Requested-With, Content-Type, Authorization, Accept, x-api-key"
        },
        {
          "key": "Access-Control-Allow-Credentials",
          "value": "true"
        },
        {
          "key": "Access-Control-Max-Age",
          "value": "86400"
        },
        {
          "key": "X-RateLimit-Limit",
          "value": "1000"
        },
        {
          "key": "X-RateLimit-Remaining",
          "value": "999"
        },
        {
          "key": "X-RateLimit-Reset",
          "value": "1609459200"
        }
      ]
    },
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        },
        {
          "key": "Strict-Transport-Security",
          "value": "max-age=31536000; includeSubDomains"
        },
        {
          "key": "Referrer-Policy",
          "value": "strict-origin-when-cross-origin"
        },
        {
          "key": "Content-Security-Policy",
          "value": "default-src 'self'; img-src 'self' data: https:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"
        }
      ]
    },
    {
      "source": "/health",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "no-cache, no-store, must-revalidate"
        }
      ]
    }
  ],
  "routes": [
    {
      "src": "/health",
      "dest": "/dist/server.js",
      "methods": ["GET"]
    },
    {
      "src": "/api/v1/auth/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/users/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/partners/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/pens/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/cattle-purchases/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/sale-records/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/expenses/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/revenues/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/payer-accounts/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/categories/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/cycles/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/interventions/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    },
    {
      "src": "/api/v1/analytics/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "OPTIONS"]
    },
    {
      "src": "/api/v1/reports/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "POST", "OPTIONS"]
    },
    {
      "src": "/api/v1/dashboard/(.*)",
      "dest": "/dist/server.js",
      "methods": ["GET", "OPTIONS"]
    },
    {
      "src": "/api/v1/(.*)",
      "dest": "/dist/server.js"
    },
    {
      "src": "/(.*)",
      "dest": "/dist/server.js"
    }
  ],
  "crons": [
    {
      "path": "/api/v1/cron/daily-reports",
      "schedule": "0 0 * * *"
    },
    {
      "path": "/api/v1/cron/cleanup-sessions",
      "schedule": "0 */6 * * *"
    }
  ],
  "github": {
    "enabled": true,
    "autoAlias": true
  },
  "public": false
}